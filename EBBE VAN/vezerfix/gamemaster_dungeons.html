<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Damareen ‚Äì Kazamat√°k Szerkeszt√©se</title>
  {% load static %}
  <link rel="stylesheet" href="{%static 'style.css'%}">
  <script src="{%static 'script.js'%}" defer></script>
</head>
<body>
  <button class="btn back-btn" onclick="logout()">‚¨Ö Kijelentkez√©s</button>
  <div class="container">
    <h1>üëë Kazamat√°k Szerkeszt√©se</h1>
    <div class="top-action-bar">
      <p class="info-message" style="margin: 0;">V√°lassz ki egy kazamat√°t √©s √°ll√≠tsd √∂ssze az ellenf√©l paklijat! Be tudod kapcsolni a l√°that√≥s√°got, hogy a j√°t√©kosok is l√°thass√°k.</p>
      <button class="btn btn-success" onclick="showCreateDungeonModal()">‚ûï √öj Kazamata</button>
    </div>
    <div class="dungeons-grid" id="gmDungeonsGrid"></div>
  </div>

  <!-- Pakli szerkeszt√©s -->
  <div id="gmDeckScreen" class="screen">
    <button class="btn return-btn" onclick="backToGMDungeons()">‚¨Ö Vissza</button>
    <div class="container">
      <h1>üëë Kazamata Szerkeszt√©se</h1>
      <div class="deck-builder-container">
        <h2 id="gmDeckTitle">Kazamata neve</h2>
        <div class="deck-info">
          <h3>Kiv√°lasztott k√°rty√°k: <span id="gmCardCount">0</span></h3>
          <p>√Åll√≠tsd √∂ssze az ellenf√©l paklij√°t. V√°lassz sima k√°rty√°kat √©s opcion√°lisan vez√©rk√°rty√°kat!</p>
          <p><strong>K√°rtya k√∂vetelm√©ny:</strong> <span id="dungeonCardRequirement">0-0</span> k√°rtya</p>
          <div class="deck-requirements">
            <p><strong>Kazamata t√≠pusok k√∂vetelm√©nyei:</strong></p>
            <ul>
              <li>‚úÖ <strong>Egyszer≈±</strong>: 1 sima k√°rtya (nincs vez√©rk√°rtya)</li>
              <li>‚úÖ <strong>Kis</strong>: 3 sima k√°rtya + 1 vez√©rk√°rtya</li>
              <li>‚úÖ <strong>Nagy</strong>: 5 sima k√°rtya + 1 vez√©rk√°rtya</li>
            </ul>
          </div>
        </div>
        <div style="display: flex; gap: 15px; margin-bottom: 20px;">
          <button class="btn btn-success btn-small" onclick="showCreateCardModal()">‚ûï √öj Sima K√°rtya</button>
          <button class="btn btn-secondary btn-small" onclick="showCreateLeaderCardModal()">üëë √öj Vez√©rk√°rtya</button>
        </div>
        
        <h3>Sima K√°rty√°k</h3>
        <div class="cards-grid" id="gmNormalCardsGrid"></div>
        
        <h3>Vez√©rk√°rty√°k</h3>
        <div class="cards-grid" id="gmLeaderCardsGrid"></div>
        
        <button class="btn" onclick="saveDungeon()">üíæ Kazamata ment√©se</button>
      </div>
    </div>
  </div>

  <!-- Mod√°lok -->
  <div id="createDungeonModal" class="modal">
    <div class="modal-content">
      <h2>‚ûï √öj Kazamata L√©trehoz√°sa</h2>
      <div class="form-group">
        <label for="newDungeonName">Kazamata neve</label>
        <input type="text" id="newDungeonName" placeholder="P√©ld√°ul: S√∂t√©t Erd≈ë">
      </div>

      <div class="form-group">
        <label for="newDungeonType">Kazamata t√≠pusa</label>
        <select id="newDungeonType" class="dungeon-select">
          <option value="">V√°lassz t√≠pust...</option>
          <option value="Egyszer≈±">Egyszer≈±</option>
          <option value="Kis">Kis</option>
          <option value="Nagy">Nagy</option>
        </select>
      </div>

      <div class="form-group">
        <label for="newDungeonVariant">Kazamata v√°ltozata</label>
        <select id="newDungeonVariant" class="dungeon-select">
          <option value="">V√°lassz v√°ltozatot...</option>
          <option value="Hegy">Hegy</option>
          <option value="Sivatag">Sivatag</option>
          <option value="Mocs√°r">Mocs√°r</option>
          <option value="Barlang">Barlang</option>
          <option value="Dzsungel">Dzsungel</option>
        </select>
      </div>

      <div class="modal-buttons">
        <button class="btn btn-success" onclick="createDungeon()">L√©trehoz√°s</button>
        <button class="btn btn-secondary" onclick="closeCreateDungeonModal()">M√©gse</button>
      </div>
    </div>
  </div>

  <div id="createCardModal" class="modal">
    <div class="modal-content">
      <h2>‚ûï √öj K√°rtya L√©trehoz√°sa</h2>

      <div class="form-group">
        <label for="newCardName">K√°rtya neve</label>
        <input type="text" id="newCardName" placeholder="P√©ld√°ul: T≈±z D√©mon">
      </div>

      <div class="form-group">
        <label for="newCardElement">K√°rtya eleme</label>
        <select id="newCardElement" class="dungeon-select">
          <option value="earth">üåç F√∂ld</option>
          <option value="air">üí® Leveg≈ë</option>
          <option value="fire">üî• T≈±z</option>
          <option value="water">üíß V√≠z</option>
        </select>
      </div>

      <div class="form-group">
        <label for="newCardAttack">T√°mad√°s</label>
        <input type="number" id="newCardAttack" placeholder="2-100" min="2" max="100" value="5">
      </div>

      <div class="form-group">
        <label for="newCardHealth">√âleter≈ë</label>
        <input type="number" id="newCardHealth" placeholder="1-100" min="1" max="100" value="3">
      </div>

      <div class="modal-buttons">
        <button class="btn btn-success" onclick="createCard()">L√©trehoz√°s</button>
        <button class="btn btn-secondary" onclick="closeCreateCardModal()">M√©gse</button>
      </div>
    </div>
  </div>

  <div id="createLeaderCardModal" class="modal">
    <div class="modal-content">
      <h2>üëë Vez√©rk√°rtya L√©trehoz√°sa</h2>

      <div class="form-group">
        <label for="baseCardForLeader">Alap k√°rtya</label>
        <select id="baseCardForLeader" class="dungeon-select" onchange="updateLeaderCardPreview()">
          <option value="">V√°lassz alap k√°rty√°t...</option>
        </select>
      </div>

      <div class="form-group">
        <label for="leaderCardName">Vez√©rk√°rtya neve</label>
        <input type="text" id="leaderCardName" placeholder="P√©ld√°ul: T≈±z Vez√©r" oninput="updateLeaderCardPreview()">
      </div>

      <div class="leader-card-options">
        <h4>V√°lassz m√≥dos√≠t√°st:</h4>
        <div class="leader-option">
          <input type="radio" id="doubleAttack" name="leaderModification" value="attack" checked onchange="updateLeaderCardPreview()">
          <label for="doubleAttack">T√°mad√°s dupl√°z√°sa</label>
        </div>
        <div class="leader-option">
          <input type="radio" id="doubleHealth" name="leaderModification" value="health" onchange="updateLeaderCardPreview()">
          <label for="doubleHealth">√âleter≈ë dupl√°z√°sa</label>
        </div>
      </div>

      <div class="leader-preview">
        <h4>El≈ën√©zet:</h4>
        <div id="leaderCardPreview">
          <p>V√°lassz egy alap k√°rty√°t az el≈ën√©zethez.</p>
        </div>
      </div>

      <div class="modal-buttons">
        <button class="btn btn-success" onclick="createLeaderCard()">Vez√©rk√°rtya L√©trehoz√°sa</button>
        <button class="btn btn-secondary" onclick="closeCreateLeaderCardModal()">M√©gse</button>
      </div>
    </div>
  </div>

  <script>
    function editDungeon(dungeonId) {
      currentDungeon = window.allDungeons.find(d => d.id === dungeonId);
      
      // Bet√∂ltj√ºk a kazamata specifikus k√°rty√°kat
      selectedNormalCards = currentDungeon.enemyCards || [];
      selectedLeaderCards = currentDungeon.leaderCards || [];
      
      document.getElementById('gmDeckTitle').textContent = currentDungeon.name + ' - Szerkeszt√©s';
      document.getElementById('dungeonCardRequirement').textContent = `${currentDungeon.minCards}-${currentDungeon.maxCards}`;
      
      renderGMCards();
      showScreen('gmDeckScreen');
    }
  </script>
</body>
</html>